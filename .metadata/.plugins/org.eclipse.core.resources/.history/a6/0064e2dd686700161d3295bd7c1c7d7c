<%@ page language="java" pageEncoding="UTF-8" trimDirectiveWhitespaces="true"%>

<div class="content">		
<html>
	<head>
		<meta charset="utf-8">
    	<meta http-equiv="X-UA-Compatible" content="IE=edge">
		<meta name="viewport" content="width=device-width, initial-scale=1">
		<link href="css/bootstrap.min.css" rel="stylesheet">
		
		<script src="jquery-2.2.3.js"></script>
		<title>자유게시판</title>
		<style>
			h1
			{
				text-align:center;
			}
			
			/* 게시판 다운 이미지로 만들기 위해 부트스트랩 커스터마이징 */
			.well 
			{
			  margin-bottom: 3px;
			  padding: 10px;
			}
			.write
			{
				text-align:right;
			}
		</style>
		<script>
			$(document).on("ready",function(){
				/* console.log($(".numbOfBoard")); */
				/* 게시글에 번호를 만들어주기 위한 for문 */
				/* 검색 처리 만들면서 번호 만들어주는 방식을 바꿈 */
				<%-- for(var i=$(".numbOfBoard").length;i>0;i--)
				{
					$(".numbOfBoard").eq($(".numbOfBoard").length-i).text(<%=rs.getInt("article_no") %>);
				} --%>

				
				/* 버튼 클릭하면 자기 자신에게 걸색어를 보내줌 */
				$(".searchBtn").on('click',function(){
					/* console.log($(".searchList").val()); */
					$("form").submit();
				});				
			});				
		</script>
	</head>
	
	<body>
		<div class="row">
			<div class="col-md-3">
			</div>
			<div class="col-md-6 well">
				<h1>자유 게시판</h1>
			</div>
			<div class="col-md-3">
			</div>
		</div>
		<br><br>
		
		<div class="row">
			<div class="col-md-3">
			</div>
			<div class="col-md-5">	
			</div>
			<div class="col-md-1 write">
				<a href="/board/addArticleForm.jsp">글쓰기</a>
			</div>
			<div class="col-md-3">
			</div>
		</div>
		<br>
		
		<div class="row">
			<div class="col-md-3">
			</div>
			<div class="col-md-6 well">
				<div class="row">
					<div class="col-md-1">
						No
					</div>
					<div class="col-md-8">
						제목
					</div>
					<div class="col-md-3">
						등록 시간
					</div>
				</div>
			</div>
			<div class="col-md-3">
			</div>
		</div>
		
	<%
		// 1. article title 목록 날짜의 내림차순
		// 2. 제목 링크 <a href="/board/articleContent.jsp">
		request.setCharacterEncoding("euc-kr");
		String searchList=request.getParameter("searchList");
		/* System.out.println(searchList); */
		
		Class.forName("com.mysql.jdbc.Driver");
		
		String url = "jdbc:mysql://127.0.0.1:3306/board?useUnicode=true&characterEncoding=euckr";
	  	String user = "root";
	  	String userPw = "java0000";
	
		Connection conn=DriverManager.getConnection(url,user,userPw);
		
		/* 검색처리하는 query문에서 startIndex는 시작인덱스
		nubShowArticle 는 이 개수만큼 select 할 것임 */
		int startIndex=0;
		int nubShowArticle=5;
		
		
/* 		'이전'이나 '다음' 안 누른 초창기에는 그냥 보여주고
		누르면서 startIndex 값이 생기면 해당하는 리스트 보여줌 */
		if(null==(request.getParameter("startIndex")))
		{
			startIndex=0;
			nubShowArticle=5;
		}
		else
		{
			startIndex=Integer.parseInt(request.getParameter("startIndex"));
			
			/* '이전','다음'클릭으로 끝까지 갔을 때, 다시 순환되도록 하고 싶었음.
			그래서 튜플들의 갯수가 필요함. */			
			String sql3="select count(article_no) numbCount from article";
			PreparedStatement pstmt3=conn.prepareStatement(sql3);			
			ResultSet rs3=pstmt3.executeQuery();
			
			/* 게시글의 갯수가 바뀌더라도 페이지 순환이 유지되도록 
			아예 변수로 지정 */
			int numbCount=0;
			if(rs3.next())
			{
				numbCount=rs3.getInt("numbCount");
			}
						
			
			/* 페이지 순환되도록 조건줌*/
			if(startIndex<0)
			{
				startIndex=((numbCount-1)/5)*5;
			}
 			else if(startIndex>numbCount)
			{
				startIndex=0;
			}
			
		}
		
		
		/* 검색 안 했을 때, 기본 리스트 뿌려주기 */
		if(null==searchList)
		{
			String sql="select article_no,article_date,article_title from article order by article_date desc limit ?,?";
			PreparedStatement pstmt=conn.prepareStatement(sql);
			pstmt.setInt(1,startIndex);
			System.out.println(startIndex);
			pstmt.setInt(2,nubShowArticle);
			
			ResultSet rs=pstmt.executeQuery();
		
			while(rs.next())
			{
	
	%>
		
		
				<div class="row">
					<div class="col-md-3">
					</div>
					<div class="col-md-6 well">
						<div class="row">
							<div class="col-md-1 numbOfBoard">
								<%=rs.getInt("article_no")%>
							</div>
							<div class="col-md-8 titleOfArticle">
								<a href="./articleContent.jsp?articleNo=<%=rs.getInt("article_no") %>"><%=rs.getString("article_title") %></a>
							</div>
							<div class="col-md-3 dateOfArticle">
								<%=rs.getString("article_date") %>
							</div>
						</div>
					</div>
					<div class="col-md-3">
					</div>
				</div>
		
	<%
			}
	
		}
		
		/* 검색 했을 때, 리스트 보여주기 */
		else
		{
			String searchKeyWord="%"+searchList+"%";
			/* System.out.println(searchKeyWord); */
		
			String sql2="select article_no,article_date,article_title from article where article_title like ? order by article_date desc";
			PreparedStatement pstmt2=conn.prepareStatement(sql2);
			pstmt2.setString(1,searchKeyWord);
			
			ResultSet rs2=pstmt2.executeQuery();
			/* System.out.println(rs);
			System.out.println(rs2); */
			
			while(rs2.next())
			{
	%>
				<div class="row">
					<div class="col-md-3">
					</div>
					<div class="col-md-6 well">
						<div class="row">
							<div class="col-md-1 numbOfBoard">
								<%=rs2.getInt("article_no")%>
							</div>
							<div class="col-md-8 titleOfArticle">
								<a href="./articleContent.jsp?articleNo=<%=rs2.getInt("article_no") %>"><%=rs2.getString("article_title") %></a>
							</div>
							<div class="col-md-3 dateOfArticle">
								<%=rs2.getString("article_date") %>
							</div>
						</div>
					</div>
					<div class="col-md-3">
					</div>
				</div>
				
		
	<%
			}
	
		}
	%>
	
	
		<br><br>			
					
		<!-- 일단 형태만 놔두고 나중에 쓰든지 하겠음 -->
		<div class="row">
			<div class="col-md-3">
			</div>
			<div class="col-md-1">
				<a href="./articleList.jsp?startIndex=0">맨앞</a>	
				<a href="./articleList.jsp?startIndex=<%=startIndex-5%>">이전</a>	
			</div>
			<div class="col-md-4">
				
			</div>
			<div class="col-md-1">
				<a href="./articleList.jsp?startIndex=<%=startIndex+5%>">다음</a>
				<a href="./articleList.jsp?startIndex=24">맨뒤</a>
			</div>
			<div class="col-md-3">
			</div>
		</div>
		<br><br><br>
		
		<form action="./articleList.jsp" method="post">
			<div class="row">
				<div class="col-md-3">
				</div>
				<div class="col-md-3">
					제목으로 검색
					<input class="searchList form-control" type="text" name="searchList">
					<input class="searchBtn" type="button" value="찾기">
				</div>
				<div class="col-md-2">
				</div>
				<div class="col-md-1">
					
				</div>
				<div class="col-md-3">
				</div>
			</div>
		</form>
		
		<!-- 클릭하면 검색 처리해서 가져와서 덮어쓰기 하는 식으로 하는 게 나을듯. 처리도 그냥 여기서 해버리고, 다 하면 될듯. -->
	</body>
</html>
		

		
</div>